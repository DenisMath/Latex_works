\documentclass[a4paper,11pt]{article}

\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[russian,english]{babel}
\usepackage{amsfonts}
\usepackage{amssymb,upref}
\usepackage{amsmath,amsthm}
\usepackage{multicol}
\usepackage{geometry}
\usepackage[dvips]{graphicx}

\setcounter{MaxMatrixCols}{10}

\newtheorem{theorem}{Теорема}[subsection]
\newtheorem{lemma}{Лемма}[subsection]
\newtheorem{corollary}{Следствие}[subsection]
\newtheorem{remark}{Замечание}[subsection]
\newtheorem{definition}{Определение}[subsection]
\newtheorem{example}{Пример}[subsection]
\newtheorem{hyp}{Гипотеза}[subsection]
\newtheorem{question}{Вопрос}[subsection]

\begin{document}
\thispagestyle{plain}

%Создание математической модели модуля Оракул.
% \section{Постановка задачи}
% Мужчина не пьет пиво - не предлагать ему пиво в контекстной рекламе.
% \section {Данные для построения}
% Нормализированная база данных логов.
% \subsection {Входные данные}
% Набор значений параметров - возраст, доход, образование и т.д.
% \subsection {Выходные данные}
% Набор IP и(или) device\_id
% \section {Параметризация модуля}
% Параметризация модуля связана с входными параметрами - возраст, доход, образование и т.д.
% \section{Плагин}
% Плагин расширения набора ip и id. На входе - набор ip и id, на выходе - расширенный набор ip и id возможно с действительным параметром. 
\section*{Алгоритм постоения HouseHolds}
Базовыми сущностями положим множество логов. Мотивация для рассмотрения именно такого базового множества, а не множества девайсов, состоит в начальной неопределенности данного множества, а, следовательно, усложнение модели формалистикой теории нечетких множеств. 

Общая схема алгоритма:
\begin{enumerate}
\item Фильтрация  данных
\item Сортировка данных
\item Создание ip-блоков
\item Построение HouseHolds
\end{enumerate}

$$\mathfrak{L}^{(1)}  \stackrel{f}{ \longrightarrow } \mathfrak{L}^{(2)}\stackrel{s}{ \longrightarrow } \mathfrak{L}^{(2)}\stackrel{g}{ \longrightarrow } \mathfrak{L}^{(3)}$$


\section{Фильтрация  данных}
\section{Сортировка данных}
\section{Построение ip-блоков}
Создается скелет для ip-блоков. Для этого из множества логов выбираются логи с определенными координатами из доверительных источников. Полученное множество логов сортируется по ip. В полученных ip-группах данные сортируются по времени. 

Строятся скелеты ip-блоков. При построении скелетов ip-блоков возможно распараллеливание по различным ip-группам. По скелету ip-блока непосредственно строится ip-блок.

Каждому ip-блоку приписывается id-инвариант.

ip-блоки проверяются на принадлежность к одному household путем анализа id-инвариантов. id-инварианты складываются.

\section{Алгоритм}
$\mathfrak{H}$ - set of households

Будем исходить из предположения, что отображение $$f: time\times ip\rightarrow\mathfrak{H}$$ является инъективным.


\subsection{Стабилизация координат}
Выберем базовою величину дискретизации временной прямой(1 час, 6 часов, день и т.д.). Базовой длиной необходимо выбирать величину временного отрезка, для которого, предположительно, изменения ip не происходят. 

Разобьем множество логов на базовые блоки - в один блок попадают логи с одинаковым ip, зафиксированные на одном базовом интервале временной прямой.

 К каждому базовому блоку методом коллаборативной фильтрации привяжем координаты. Поскольку анализ данных показывает недостоверность части координат, полученных в логах, вычисление предположительной координаты, соответствующей блоку, происходит при помощи статистических методов. 
\subsection{hh-инвариант}
В базовом блоке определен hh-инвариант - вектор весов при соответствующих id.

Для объединения 2-х блоков hh-инвариант определен, как сумма hh-инвариантов соответствующих блоков.

 При суммировании поле с отсутствующим id добавляется со значением 0. Суммирование происходит покомпонентно, как в случае сложения векторов.
\begin{definition}
Инвариант базового блока определен следующим образом:
\begin{enumerate}
  \item Пробегаемся по множеству логов - если id присутсвует в логе, увеличиваем значение соответствующей координаты инварианта на 1. Если поле id отсутствует в инварианте - добавляем его.
  \item Если id в логе не определено - добавляем к значениям инварианта значения, полученные в результате статистического анализа полей лога, что определены.
  \end{enumerate}

\end{definition}

\subsection{Принадлежность ip-блоков к одному household}
На множестве пар ip блоков введем коэффициент связи принадлежности к одному household, определенный, как коэффициент корреляции hh-инвариантов данных блоков.
$$hh\_LLW (Block_1, Block_2) = \frac{\sum\limits_{X = pr_i(hh\_inv_1), Y = pr_i(hh\_inv_2)}(X-\bar{X})(Y-\bar{Y})}{\sqrt{\sum\limits_{X = pr_i(hh\_inv_1)} (X-\bar{X})^2\sum\limits_{Y = pr_i(hh\_inv_2)} (Y-\bar{Y})^2}}$$
 Чем ближе данный коэффициент к еденице, тем больше вероятность того, что данные ip-блоки соответсвуют одному household (функция $hh\_LLW$)
\end{document}
